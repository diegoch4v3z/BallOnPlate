

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Barrier Synchronization Testing &mdash; NxSDK 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Characterization Tutorial" href="timeAndEnergyPerOp.html" />
    <link rel="prev" title="Characterization" href="../characterization.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> NxSDK
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introductory Material</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nxapi.html">NxAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nxnet.html">NxNet API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nxcore.html">NxCore API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../composable.html">Composability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embedded_execution_engine.html">Embedded Execution Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modules.html">Nx SDK Modules</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../characterization.html">Characterization</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../characterization.html#tutorials">Tutorials</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="i_performance_profiling.html">9. Performance profiling</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Barrier Synchronization Testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="timeAndEnergyPerOp.html">Characterization Tutorial</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dnn.html">DNN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dvs.html">DVS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../epl.html">EPL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../knn.html">K Nearest Neighbour</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input_generator.html">Input Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lca.html">LCA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../path_planning.html">Path Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../slayer.html">SLAYER Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../slic.html">SLIC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spike_streamer.html">Spike Streamer Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trace_injection.html">Trace Injection Module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../performance-suite.html">NxSDK Performance Test Suite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html">NxSDK Release History</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NxSDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../modules.html">Nx SDK Modules</a> &raquo;</li>
        
          <li><a href="../characterization.html">Characterization</a> &raquo;</li>
        
      <li>Barrier Synchronization Testing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># INTEL CORPORATION CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># Copyright © 2020-2021 Intel Corporation.</span>
<span class="c1">#</span>
<span class="c1"># This software and the related documents are Intel copyrighted</span>
<span class="c1"># materials, and your use of them is governed by the express</span>
<span class="c1"># license under which they were provided to you (License). Unless</span>
<span class="c1"># the License provides otherwise, you may not use, modify, copy,</span>
<span class="c1"># publish, distribute, disclose or transmit  this software or the</span>
<span class="c1"># related documents without Intel&#39;s prior written permission.</span>
<span class="c1">#</span>
<span class="c1"># This software and the related documents are provided as is, with</span>
<span class="c1"># no express or implied warranties, other than those that are</span>
<span class="c1"># expressly stated in the License.</span>
</pre></div>
</div>
</div>
<div class="section" id="Barrier-Synchronization-Testing">
<h1>Barrier Synchronization Testing<a class="headerlink" href="#Barrier-Synchronization-Testing" title="Permalink to this headline">¶</a></h1>
<p>This tutorial applies NxSDK performance benchmarking tools to a test of barrier synchronization.</p>
<div class="section" id="Understanding-Barrier-Synchronization-Constraints">
<h2>Understanding Barrier Synchronization Constraints<a class="headerlink" href="#Understanding-Barrier-Synchronization-Constraints" title="Permalink to this headline">¶</a></h2>
<p>Each Loihi Chip consists of 3 Lakemont processors, and 4 by 8 grid of Neurocore tiles, with each tile containing 4 Neurocores. A Nahuku32 system has 32 Loihi Chips, but a model running on Nahuku32 may only require a small fraction of the Loihi Chips, or even a small fraction (a few cores) of 1 Loihi chip.</p>
<p>All Chips required to run a model (all chips simulating at least 1 neuron from the model) must synchronize their timesteps with each other through barrier synchronization.</p>
<p>Barrier synchronization must operate on a rectangular arrangement of Chips.</p>
<p>After compilation, NxSDK knows which Chips are required by the model, and a rectangular barrier synchronization region is defined which encompasses all required Chips. Is is possible that some Chips with no neurons fall within the barrier synchronization rectangle, in which case those Chips must also participate in barrier synchronization.</p>
<p>For example, if 11 chips (0 to 10) of a Nahuku32 board are required to run a model, then 16 chips (0 to 15) will be part of barrier sync.</p>
<p><img alt="Barrier Sync Chips" src="../_images/barrier_sync_chips.png" /></p>
<p>For each Chip within the barrier synchronization region, an internal (in-chip) rectangular barrier synchronization region must be defined which encompasses Lakemont 0, any Lakemonts running snips, and any Neurocores which have at least 1 neuron. In-chip barrier synchronization is defined at the scale of tiles (either all 4 cores in a tile participate, or none), and all Neurocores within the in-chip barrier synchronization region must participate, and all Neurocores participating in barrier sync
must be fully powered.</p>
<p>For example, a model requiring 40 cores (core 0 to 39) would occupy the red tiles in the image below. Lakemont 0 must also participate in barrier sync, so the blue region is defined.</p>
<p><img alt="Barrier Sync Cores" src="../_images/barrier_sync_cores.png" /></p>
<p>Loihi’s power saving features include clock gating all Lakemonts which aren’t participating in barrier synchronization, and powering down all Neurocores which aren’t participating in barrier synchronization.</p>
</div>
<div class="section" id="Test-Design">
<h2>Test Design<a class="headerlink" href="#Test-Design" title="Permalink to this headline">¶</a></h2>
<p>To run the test, we specify a number of chips, and two cores addresses. The test places 2 neurons on each chip, one at each core address. During compilation, NxSDK will define the inter-chip barrier sync region as well as each in-chip barrier sync region. An init phase snip turns off the 2 neurons on each chip before the run starts, so we end up just running an empty model with no neurons.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">nxsdk_modules.characterization.src.characterization</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">nxsdk.logutils.nxlogging</span> <span class="kn">import</span> <span class="n">set_verbosity</span><span class="p">,</span> <span class="n">LoggingLevel</span>
<span class="n">set_verbosity</span><span class="p">(</span><span class="n">LoggingLevel</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#boardName=&#39;ncl-ext-ghrd-01&#39;</span>
<span class="n">boardName</span><span class="o">=</span><span class="s1">&#39;ncl-ghrd-04&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Single-Chip-Test">
<h2>Single Chip Test<a class="headerlink" href="#Single-Chip-Test" title="Permalink to this headline">¶</a></h2>
<p>In the first test we use only a single chip. One neuron is placed in the bottom right tile, and the other neuron starts in the bottom left, and moves up one tile in each subsequent run. This means we’ll start with a barrier sync region encompassing only the bottom row, and in each subsequent run will include 1 more row of tiles.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">numCoresSynchronizedPerChip</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">timePerTimestep</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">numChips</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">bsCoreEnd</span> <span class="o">=</span> <span class="mi">112</span>
<span class="k">for</span> <span class="n">bsCoreStart</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running test with start core at address </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bsCoreStart</span><span class="p">))</span>
    <span class="n">powerStats</span> <span class="o">=</span> <span class="n">testBarrierSync</span><span class="p">(</span><span class="n">runTime</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
                                    <span class="n">bsCores</span><span class="o">=</span><span class="p">[</span><span class="n">bsCoreStart</span><span class="p">,</span><span class="n">bsCoreEnd</span><span class="p">],</span>
                                    <span class="n">numChips</span><span class="o">=</span><span class="n">numChips</span><span class="p">,</span>
                                    <span class="n">boardName</span><span class="o">=</span><span class="n">boardName</span><span class="p">)</span>

    <span class="n">numCoresSynchronizedPerChip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">powerStats</span><span class="o">.</span><span class="n">numCoresActuallyOn</span><span class="o">/</span><span class="n">powerStats</span><span class="o">.</span><span class="n">numChipsActuallyBeingUsed</span><span class="p">)</span>
    <span class="n">timePerTimestep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">powerStats</span><span class="o">.</span><span class="n">timePerTimestep</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numCoresSynchronizedPerChip</span><span class="p">,</span> <span class="n">timePerTimestep</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numCoresSynchronizedPerChip</span><span class="p">,</span> <span class="n">timePerTimestep</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Single Chip Barrier Synchronization Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cores in barrier sync&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Time per Timestep ($\mu$s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Running test with start core at address 0
Running test with start core at address 4
Running test with start core at address 8
Running test with start core at address 12
    Processing timeseries... s...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/jupyter_timeAndEnergyBarrierSync_5_1.png" src="../_images/jupyter_timeAndEnergyBarrierSync_5_1.png" />
</div>
</div>
</div>
<div class="section" id="Multi-Chip-Test">
<h2>Multi Chip Test<a class="headerlink" href="#Multi-Chip-Test" title="Permalink to this headline">¶</a></h2>
<p>In the second test we keep the in-chip barrier synchronization region constant (bottom row only) for all active Lakemonts in each run and vary the number of chips.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">numCoresSynchronizedPerChip</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">numChipsSynchronized</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">timePerTimestep</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">neuroCoreDynamicEnergyPerTimestep</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">staticPower</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">bsCoreStart</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">bsCoreEnd</span> <span class="o">=</span> <span class="mi">127</span>
<span class="k">for</span> <span class="n">numChips</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">32</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running test with </span><span class="si">{}</span><span class="s2"> chips&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numChips</span><span class="p">))</span>
    <span class="n">powerStats</span> <span class="o">=</span> <span class="n">testBarrierSync</span><span class="p">(</span><span class="n">runTime</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
                                 <span class="n">bsCores</span><span class="o">=</span><span class="p">[</span><span class="n">bsCoreStart</span><span class="p">,</span><span class="n">bsCoreEnd</span><span class="p">],</span>
                                 <span class="n">numChips</span><span class="o">=</span><span class="n">numChips</span><span class="p">,</span>
                                 <span class="n">boardName</span><span class="o">=</span><span class="n">boardName</span><span class="p">)</span>

    <span class="n">neuroCoreDynamicEnergyPerTimestep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">powerStats</span><span class="o">.</span><span class="n">power</span><span class="p">[</span><span class="s1">&#39;core&#39;</span><span class="p">][</span><span class="s1">&#39;dynamic&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">powerStats</span><span class="o">.</span><span class="n">timePerTimestep</span><span class="o">/</span><span class="mf">1e3</span><span class="p">)</span> <span class="c1">#/1e3 to convert to uJ</span>
    <span class="n">numCoresSynchronizedPerChip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">powerStats</span><span class="o">.</span><span class="n">numCoresActuallyOn</span><span class="o">/</span><span class="n">powerStats</span><span class="o">.</span><span class="n">numChipsActuallyBeingUsed</span><span class="p">)</span>
    <span class="n">numChipsSynchronized</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">powerStats</span><span class="o">.</span><span class="n">numChipsActuallyBeingUsed</span><span class="p">)</span>
    <span class="n">timePerTimestep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">powerStats</span><span class="o">.</span><span class="n">timePerTimestep</span><span class="p">)</span>

    <span class="c1"># show the full power of all the cores involved in barrier synchronization</span>
    <span class="n">staticPower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">powerStats</span><span class="o">.</span><span class="n">power</span><span class="p">[</span><span class="s1">&#39;core&#39;</span><span class="p">][</span><span class="s1">&#39;static&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">powerStats</span><span class="o">.</span><span class="n">numCoresActuallyOn</span><span class="o">/</span><span class="n">powerStats</span><span class="o">.</span><span class="n">numCores</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numChipsSynchronized</span><span class="p">,</span> <span class="n">timePerTimestep</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numChipsSynchronized</span><span class="p">,</span> <span class="n">timePerTimestep</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Multi-Chip Barrier Synchronization Time with </span><span class="si">{:.0f}</span><span class="s2"> Cores per chip&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numCoresSynchronizedPerChip</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Chips in barrier sync&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Time per Timestep ($\mu$s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numChipsSynchronized</span><span class="p">,</span> <span class="n">neuroCoreDynamicEnergyPerTimestep</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numChipsSynchronized</span><span class="p">,</span> <span class="n">neuroCoreDynamicEnergyPerTimestep</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Multi-Chip Barrier Synchronization Energy with </span><span class="si">{:.0f}</span><span class="s2"> Cores per chip&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numCoresSynchronizedPerChip</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Chips in barrier sync&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Dynamic Energy per Timestep ($\mu$J)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numChipsSynchronized</span><span class="p">,</span> <span class="n">staticPower</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numChipsSynchronized</span><span class="p">,</span> <span class="n">staticPower</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Multi-Chip Static Power with </span><span class="si">{}</span><span class="s2"> Cores per chip&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numCoresSynchronizedPerChip</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Chips in barrier sync&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Neurocore Static Power Consumption (mW)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Running test with 1 chips
Running test with 2 chips... s...
Running test with 4 chips... s...
Running test with 8 chips... s...
Running test with 16 chips.. s...
Running test with 24 chips.. s...
Running test with 32 chips.. s...
    Processing timeseries... s...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/jupyter_timeAndEnergyBarrierSync_7_1.png" src="../_images/jupyter_timeAndEnergyBarrierSync_7_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/jupyter_timeAndEnergyBarrierSync_7_2.png" src="../_images/jupyter_timeAndEnergyBarrierSync_7_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/jupyter_timeAndEnergyBarrierSync_7_3.png" src="../_images/jupyter_timeAndEnergyBarrierSync_7_3.png" />
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="timeAndEnergyPerOp.html" class="btn btn-neutral float-right" title="Characterization Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../characterization.html" class="btn btn-neutral float-left" title="Characterization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018-2021, Intel Corporation.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>